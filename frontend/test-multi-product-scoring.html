<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Product Scoring Test</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            margin-bottom: 30px;
        }
        .test-profiles {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }
        .profile-card {
            border: 2px solid #e2e8f0;
            padding: 20px;
            border-radius: 10px;
            background: #f7fafc;
        }
        .profile-card h3 {
            margin-top: 0;
            color: #4a5568;
        }
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
            transition: transform 0.2s;
        }
        button:hover {
            transform: translateY(-2px);
        }
        .results {
            margin-top: 30px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            display: none;
        }
        .results.show {
            display: block;
        }
        .product-scores {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .score-card {
            padding: 15px;
            border-radius: 8px;
            background: white;
            border: 2px solid #e2e8f0;
        }
        .score-card.qualified {
            border-color: #48bb78;
        }
        .score-card.not-qualified {
            border-color: #f56565;
            opacity: 0.7;
        }
        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: #2d3748;
        }
        .grade {
            display: inline-block;
            padding: 4px 8px;
            border-radius: 4px;
            font-weight: bold;
            margin-left: 10px;
        }
        .grade.A { background: #48bb78; color: white; }
        .grade.B { background: #4299e1; color: white; }
        .grade.C { background: #ed8936; color: white; }
        .grade.D { background: #f56565; color: white; }
        .grade.F, .grade.NQ { background: #718096; color: white; }
        .routing-info {
            background: #edf2f7;
            padding: 15px;
            border-radius: 8px;
            margin-top: 20px;
        }
        .value-estimate {
            font-size: 32px;
            color: #48bb78;
            font-weight: bold;
        }
        pre {
            background: #2d3748;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🎯 Multi-Product Scoring Test</h1>
        
        <div class="test-profiles">
            <div class="profile-card">
                <h3>Profile 1: Restaurant Owner (Low Credit, High Revenue)</h3>
                <p><strong>Industry:</strong> Restaurant</p>
                <p><strong>Credit Score:</strong> 580</p>
                <p><strong>Monthly Revenue:</strong> $80,000</p>
                <p><strong>Time in Business:</strong> 18 months</p>
                <p><strong>Expected:</strong> MCA A+, Term Loan NQ</p>
                <button onclick="testProfile(1)">Test This Profile</button>
            </div>
            
            <div class="profile-card">
                <h3>Profile 2: Tech Startup (High Credit, New Business)</h3>
                <p><strong>Industry:</strong> Technology</p>
                <p><strong>Credit Score:</strong> 750</p>
                <p><strong>Monthly Revenue:</strong> $30,000</p>
                <p><strong>Time in Business:</strong> 8 months</p>
                <p><strong>Expected:</strong> Credit Card Stacking A+, Term Loan NQ</p>
                <button onclick="testProfile(2)">Test This Profile</button>
            </div>
            
            <div class="profile-card">
                <h3>Profile 3: Established Retailer (Good Everything)</h3>
                <p><strong>Industry:</strong> Retail</p>
                <p><strong>Credit Score:</strong> 720</p>
                <p><strong>Monthly Revenue:</strong> $150,000</p>
                <p><strong>Time in Business:</strong> 60 months</p>
                <p><strong>Expected:</strong> Qualified for all products</p>
                <button onclick="testProfile(3)">Test This Profile</button>
            </div>
            
            <div class="profile-card">
                <h3>Profile 4: Construction Company (Moderate Risk)</h3>
                <p><strong>Industry:</strong> Construction</p>
                <p><strong>Credit Score:</strong> 650</p>
                <p><strong>Monthly Revenue:</strong> $45,000</p>
                <p><strong>Time in Business:</strong> 30 months</p>
                <button onclick="testProfile(4)">Test This Profile</button>
            </div>
        </div>
        
        <div id="results" class="results">
            <h2>Scoring Results</h2>
            <div id="resultsContent"></div>
        </div>
    </div>
    
    <script>
        const profiles = {
            1: {
                businessName: "Test Restaurant",
                contactName: "John Doe",
                email: "restaurant@test.com",
                phone: "555-0001",
                industry: "Restaurant",
                creditScore: 580,
                monthlyRevenue: 80000,
                annualRevenue: 960000,
                monthsInBusiness: 18,
                loanAmount: 100000,
                urgency: "Immediate"
            },
            2: {
                businessName: "Tech Startup Inc",
                contactName: "Jane Smith",
                email: "startup@test.com",
                phone: "555-0002",
                industry: "Technology",
                creditScore: 750,
                monthlyRevenue: 30000,
                annualRevenue: 360000,
                monthsInBusiness: 8,
                loanAmount: 50000,
                urgency: "Planned"
            },
            3: {
                businessName: "Established Retail Co",
                contactName: "Bob Johnson",
                email: "retail@test.com",
                phone: "555-0003",
                industry: "Retail",
                creditScore: 720,
                monthlyRevenue: 150000,
                annualRevenue: 1800000,
                monthsInBusiness: 60,
                loanAmount: 250000,
                urgency: "Flexible"
            },
            4: {
                businessName: "Construction Corp",
                contactName: "Mike Williams",
                email: "construction@test.com",
                phone: "555-0004",
                industry: "Construction",
                creditScore: 650,
                monthlyRevenue: 45000,
                annualRevenue: 540000,
                monthsInBusiness: 30,
                loanAmount: 75000,
                urgency: "Planned"
            }
        };
        
        async function testProfile(profileNum) {
            const profile = profiles[profileNum];
            const resultsDiv = document.getElementById('results');
            const contentDiv = document.getElementById('resultsContent');
            
            contentDiv.innerHTML = '<p>Testing profile...</p>';
            resultsDiv.classList.add('show');
            
            try {
                // Test locally first (won't work due to CORS, but shows the attempt)
                const response = await fetch('http://localhost:8888/api/leads', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(profile)
                });
                
                const data = await response.json();
                displayResults(data.lead, profile);
            } catch (localError) {
                // Try production API
                try {
                    const response = await fetch('https://api.fidenta.io/api/leads', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(profile)
                    });
                    
                    const data = await response.json();
                    displayResults(data.lead, profile);
                } catch (prodError) {
                    contentDiv.innerHTML = `
                        <div style="color: red;">
                            <p>Error testing profile. Please ensure the backend is running.</p>
                            <p>Local error: ${localError.message}</p>
                            <p>Production error: ${prodError.message}</p>
                        </div>
                    `;
                }
            }
        }
        
        function displayResults(lead, originalProfile) {
            const contentDiv = document.getElementById('resultsContent');
            
            // Check if we have multi-product scores
            if (!lead.productScores) {
                contentDiv.innerHTML = `
                    <div style="color: orange;">
                        <h3>⚠️ Multi-product scoring not implemented yet</h3>
                        <p>The backend returned a single score: ${lead.leadScore}</p>
                        <p>Grade: ${lead.leadGrade}</p>
                        <p>Tier: ${lead.scoringTier}</p>
                    </div>
                `;
                return;
            }
            
            let html = `
                <h3>${originalProfile.businessName}</h3>
                <p><strong>Industry:</strong> ${originalProfile.industry} | 
                   <strong>Credit:</strong> ${originalProfile.creditScore} | 
                   <strong>Monthly Revenue:</strong> $${originalProfile.monthlyRevenue.toLocaleString()} |
                   <strong>Time in Business:</strong> ${originalProfile.monthsInBusiness} months</p>
                
                <div class="product-scores">
            `;
            
            // Display each product score
            const products = {
                mca: 'MCA',
                termLoan: 'Term Loan',
                sbaLoan: 'SBA Loan',
                lineOfCredit: 'Line of Credit',
                creditCardStacking: 'Credit Card Stacking',
                equipmentFinancing: 'Equipment Financing'
            };
            
            for (const [key, name] of Object.entries(products)) {
                const score = lead.productScores[key];
                if (score) {
                    const qualified = score.qualified && score.score > 0;
                    html += `
                        <div class="score-card ${qualified ? 'qualified' : 'not-qualified'}">
                            <h4>${name}</h4>
                            <div class="score-value">${score.score}</div>
                            <span class="grade ${score.grade}">${score.grade}</span>
                            <p>${qualified ? '✅ Qualified' : '❌ Not Qualified'}</p>
                        </div>
                    `;
                }
            }
            
            html += '</div>';
            
            // Display routing information
            if (lead.routing) {
                html += `
                    <div class="routing-info">
                        <h3>Routing Information</h3>
                        <p><strong>Recommended Product:</strong> ${lead.routing.recommendedProduct || 'None'}</p>
                        <p><strong>Qualified Products:</strong> ${lead.routing.qualifiedProducts?.join(', ') || 'None'}</p>
                        <p><strong>Credit Repair Candidate:</strong> ${lead.routing.creditRepairCandidate ? 'Yes' : 'No'}</p>
                        <p><strong>Estimated Lead Value:</strong></p>
                        <div class="value-estimate">$${lead.routing.estimatedValue}</div>
                    </div>
                `;
            }
            
            // Show raw JSON
            html += `
                <h3>Raw Response</h3>
                <pre>${JSON.stringify(lead, null, 2)}</pre>
            `;
            
            contentDiv.innerHTML = html;
        }
    </script>
</body>
</html>